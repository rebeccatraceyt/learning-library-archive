<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../assets/css/bitesize/stripe-errors.css">
    <title>Stripe Errors 500</title>
</head>
<body>
    <nav>
        <a href="../../bitesize.html">Bitesize</a>
        <a href="../../checklist.html">Checklists</a>
        <a href="../../flashcards.html">Flash</a>
    </nav>
    <section id="template-body" class="box-shadow">
        <div id="header">
            <div id="header-text">
                <h1 class="text-heading">Stripe Errors</h1>
                <span class="alt-text">
                    500 error - get debugging!
                </span>
            </div>
            <hr id="header-hr" />
        </div>
        <div class="body">
            <div>
                <p class="section-padding">A 500 error could point to almost anything in your code and can be tricky to solve. The best approach to debugging is to read the error message and look for clues.</p>
                <p class="section-padding">They will usually be descriptive enough that you can narrow your focus on specific files and/or variables.</p>
                <div class="code-block">
                    <div class="code-text code-container box-shadow">
                        <div class="code-margin">
                            <span>RuntimeError: You called this URL via POST, but the URL doesn't end in</span> <br>
                            <span>a slash and you have APPEND_SLASH set. Django can't redirect to the</span> <br>
                            <span>slash URL while maintaining POST data. Change your form to point to</span> <br>
                            <span>localhost:8000/checkout/wh/ (note the trailing slash), or set</span> <br>
                            <span>APPEND_SLASH=False in your Django settings.</span> <br>
                            <span>[29/Jul/2022 14:50:50] <span class="code-red">“POST /checkout/wh/ HTTP/1.1” 500 82585</span></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="section-margin">
                <p class="section-padding">The <span class="code-text">webhook_handler.py</span> file is a common place for issues to arise. Check your stack trace for relevant error messages, as shown below.</p>
                <div class="info-text sm-only">
                    <p>This code block is better suited for viewing on a larger device</p>
                </div>
                <div class="code-block">
                    <div class="code-text code-container box-shadow">
                        <div class="code-margin">
                            <span>[29/Jul/2022 14:56:05] "POST /checkout/wh/ HTTP/1.1" 200 44</span> <br>
                            <span>Internal Server Error: /checkout/wh/</span> <br>
                            <span>Traceback (most recent call last):</span> <br>
                            <span class="code-indent">File "/home/gitpod/.pyenv/versions/3.8.11/lib/python3.8/</span> <br>
                            <span>site-packages/django/core/handlers/exception.py", line 47, in inner</span> <br>
                            <span class="code-indent2">response = get_response(request)</span> <br>
                            <span class="code-indent">File "/home/gitpod/.pyenv/versions/3.8.11/lib/python3.8/</span> <br>
                            <span>site-packages/django/core/handlers/base.py", line 181,</span> <br>
                            <span>in _get_response</span> <br>
                            <span class="code-indent2">response = wrapped_callback(request, *callback_args, </span> <br>
                            <span>**callback_kwargs)</span> <br>
                            <span class="code-indent">File "/home/gitpod/.pyenv/versions/3.8.11/lib/python3.8/</span> <br>
                            <span>site-packages/django/views/decorators/http.py", line 40, in inner</span> <br>
                            <span class="code-indent2">return func(request, *args, **kwargs)</span> <br>
                            <span class="code-indent">File "/home/gitpod/.pyenv/versions/3.8.11/lib/python3.8/</span> <br>
                            <span>site-packages/django/views/decorators/csrf.py", line 54,</span> <br>
                            <span> in wrapped_view</span> <br>
                            <span class="code-indent2">return view_func(*args, **kwargs)</span> <br>
                            <span class="code-indent">File "/workspace/stripe_example/checkout/webhooks.py",</span> <br>
                            <span>line 66, in webhook</span> <br>
                            <span class="code-indent2">response = event_handler(event)</span> <br>
                            <span class="code-indent blue">File "/workspace/stripe_example/checkout/webhook_handler.py",</span> <br>
                            <span class="blue"> line 71, in handle_payment_intent_succeeded</span> <br>
                            <span class="code-indent2 blue">test = intent['data'][0]['email']</span> <br>
                            <span class="code-indent">File "/home/gitpod/.pyenv/versions/3.8.11/lib/python3.8/</span> <br>
                            <span>site-packages/stripe/stripe_object.py", line 131, in __getitem__</span> <br>
                            <span class="code-indent2">raise err</span> <br>
                            <span class="code-indent">File "/home/gitpod/.pyenv/versions/3.8.11/lib/python3.8/</span> <br>
                            <span>site-packages/stripe/stripe_object.py", line 119, in __getitem__</span> <br>
                            <span class="code-indent2">return super(StripeObject, self).__getitem__(k)</span> <br>
                            <span class="blue">KeyError: 'data'</span> <br>
                            <span>[29/Jul/2022 14:56:05] <span class="code-red">“POST /checkout/wh/ HTTP/1.1” 500 82585</span></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="section-margin circle-points">
                <img src="https://4060571.fs1.hubspotusercontent-na1.net/hubfs/4060571/library-assets/lightbulb_yellow_left.svg" alt="Yellow lightbulb icon tilted left">
                <p>If you can not find a helpful error message, you may need to manually debug with print statements to find out where your code is not executing as expected.</p>
            </div>
        </div>
        <div id="footer-icon">
            <img src="https://4060571.fs1.hubspotusercontent-na1.net/hubfs/4060571/library-assets/library-logo-dark.png" alt="Code Institute logo">
        </div>
    </section>
</body>
</html>


